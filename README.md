# Система автоматизированного применения правил регирования бюджета рекламы

## Устновка

- В корень проекта ```docker-compose  up -d```
    - создастся и запуститься контейнер бэкенда
        - автоматически должна развернуться база
        - автоматически должны запуститься seeders, если не запустятся выполнить самостоятель ```php artisan db:seed```
          seeders создают только объявления (Announcement) и статистику по ним (AnnouncementStat)
        - так же лучше убедиться что накатились все миграции, самостоятельно запускается командой
          ```php artisan migrate```
    - создастся и запуститься контейнер фронтенда
- После сборки перейти в браузер и запустить http://localhost:3000 должен открыться интерфейс фронтенда

## Основной функциона

Основной функционал в тестовом задании назывался "Регулятор" поэтому и получил нейминг Regulator
Состоит из:

- корневая сущность "правило" (Rule). Одним из требований было сформировать минимальную структуру таблиц, поэтому
  решено было не создавать таблицу связей "условий" и не нагружать дополнительной логикой связи (И/ИЛИ) сами условия,
  а определить шаблоны:
  -- if_then - если условие выполняется то запускать "действие". Этот шаблон может содержать только одно "условие"
  -- if_and_then - этот шаблон запускает "действие", если два "условия" выполняются.
  -- if_or_then - этот шаблон запускает "действие", если одно из "условий" выполнется.
- вторая сущность "условие" (Condition). Выполняют все операции сравнения между заданными параметра. Так же добавлен
  дополнительный параметр "свое значение". При помощи "условий" можно произвести операции сравнения между
  параметрами (clicks > views) или задать свое значение (clicks > 10)
- последняя сущность это "операция"(Action). Позволяет произвести операции увеличения или уменьшения для параметров.
  Так же расширяемы, например , добавил операцию уменьшения с ограничение бюджета. Если бюджет после операции будет
  меньше 0, то выставляем ему 0,чтобы не уходил в минус.

## Поехали!!

Для начала, в интерйесе, переходим в раздел "правила" и создаем правило. Каждому правилу надо указать один из трех
шаблонов (про шаблоны писал выше). Задаем условия, добавляем действие. Нажимаем сохранить.
Готово! Шаблон создан!
Если не запускали seeders, для создания объявлений и статистки, то сейчас самое время!

Запускаем обработку статистики. Обработка статистки правилами происходит при помощи команду

```php artisan app:process-announcement-stat-regulator-command```

Реализовал и запуск по крону через каждые 5 минут в шедулере. Но сам крон в докере не стал добавлять.  

После успешного завершения работы команды , Можно смотреть разделы "График" и "Логи" в интерфейсе.

